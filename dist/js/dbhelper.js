class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static addRestaurantsInIDB(t){return DBHelper.dbPromise.then(function(e){var a=e.transaction("restaurants","readwrite"),n=a.objectStore("restaurants");return Promise.all(t.map(function(t){return n.get(t.id)?n.put(t):n.add(t)})).catch(function(t){a.abort(),console.log(t)}).then(function(){})})}static getRestaurantsFromIDB(){return DBHelper.dbPromise.then(function(t){return t.transaction("restaurants","readonly").objectStore("restaurants").getAll()})}static getRestaurantFromIDBByName(t){return DBHelper.dbPromise.then(function(e){return e.transaction("restaurants","readonly").objectStore("restaurants").index("name").get(t)})}static fetchRestaurants(t){DBHelper.getRestaurantsFromIDB().then(function(e){void 0===e||0==e.length?DBHelper.fetchRestaurantsFromNetwork((e,a)=>{e?t(e,null):(DBHelper.addRestaurantsInIDB(a),t(null,a))}):t(null,e)})}static fetchRestaurantsFromNetwork(t){fetch(DBHelper.DATABASE_URL).then(e=>e.json().then(t=>({data:t,status:e.status})).then(e=>{t(null,e.data)})).catch(function(e){t(e,null)})}static fetchRestaurantById(t,e){DBHelper.fetchRestaurants((a,n)=>{if(a)e(a,null);else{const a=n.find(e=>e.id==t);a?e(null,a):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((a,n)=>{if(a)e(a,null);else{const a=n.filter(e=>e.cuisine_type==t);e(null,a)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((a,n)=>{if(a)e(a,null);else{const a=n.filter(e=>e.neighborhood==t);e(null,a)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,a){DBHelper.fetchRestaurants((n,r)=>{if(n)a(n,null);else{let n=r;"all"!=t&&(n=n.filter(e=>e.cuisine_type==t)),"all"!=e&&(n=n.filter(t=>t.neighborhood==e)),a(null,n)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,a)=>{if(e)t(e,null);else{const e=a.map((t,e)=>a[e].neighborhood),n=e.filter((t,a)=>e.indexOf(t)==a);t(null,n)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,a)=>{if(e)t(e,null);else{const e=a.map((t,e)=>a[e].cuisine_type),n=e.filter((t,a)=>e.indexOf(t)==a);t(null,n)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static smallImageUrlForRestaurant(t){return`/images/${t.id}-133x100.jpg`}static mediumImageUrlForRestaurant(t){return`/images/${t.id}-399x300.jpg`}static imageUrlForRestaurant(t){return`/img/${t.id}.jpg`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}DBHelper.dbPromise=idb.open("mws-restaurant",3,function(t){switch(t.oldVersion){case 0:case 1:console.log("Creating the restaurants object store"),t.createObjectStore("restaurants",{keyPath:"id"});case 2:console.log("Creating an index on name"),t.transaction.objectStore("restaurants").createIndex("name","name",{unique:!0})}});